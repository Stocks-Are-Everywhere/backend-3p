# 🌐 온 세상이 주식이야 (온세주)

## 📌 MVP 1차 (2025.02.10 ~ 2025.02.15)

### 📌 시스템 아키텍처  

#### ✅ 클라이언트 (Client)  
- 한국투자 API WebSocket에 직접 연결하여 실시간 주식 시세 데이터를 가져옴  
- UI에서 매수/매도 주문을 생성하고 서버에 전송  
- 서버에서 체결된 주문 결과를 SSE(Server-Sent Events) 또는 WebSocket으로 수신하여 UI에 표시  

#### ✅ 서버 (Server)  
- 클라이언트에서 들어온 주문을 우선순위 큐(Priority Queue)에 삽입 후 매칭 수행  
- 매칭된 주문을 DB에 저장 및 체결 결과를 클라이언트에 SSE 또는 WebSocket으로 전송  
- RocketMQ를 활용하여 주문 이벤트 처리  
- 배치 처리를 통해 체결 내역을 효율적으로 저장  

---

### 🛠 MVP 단계에서 진행한 작업  

#### ✅ 1. 클라이언트 - 실시간 데이터 수신  
- 클라이언트가 한국투자 API WebSocket에 직접 연결하여 실시간 주식 시세를 받아옴  
- 주문 가능 여부를 UI에서 확인 가능  

#### ✅ 2. 클라이언트 - 서버 통신  
- 주문 요청을 HTTP API로 전송  
- 체결 결과는 SSE(Server-Sent Events) 또는 WebSocket으로 전송  

#### ✅ 3. 서버 - 주문 처리 및 매칭  
- 우선순위 큐(Priority Queue) 활용  
    - 매수 주문: 가격 내림차순 (Max Heap)  
    - 매도 주문: 가격 오름차순 (Min Heap)  
- 주문이 체결될 경우, 자동으로 매칭 진행  
- RocketMQ로 이벤트 기반 메시지 큐 구현  

#### ✅ 4. 체결 결과 SSE(Server-Sent Events) 또는 WebSocket 전송  
- 주문이 체결되면 SSE 또는 WebSocket을 통해 클라이언트로 전달  

---

### 🚀 추가적으로 진행한 작업 (수정 내용 반영)  

#### 1️⃣ 시장가 주문 반영  
- 볼륨(거래량)을 고려하여 시장가 주문 처리 가능하도록 개선  
- 기존 지정가 주문 방식 외에 시장가 주문 추가  
- (수정 후) OrderMatchingService에서 체결 로직 개선  
- 간단한 주문 취소 기능 추가  

#### 2️⃣ RocketMQ 기반 이벤트 처리  
- 기존 메모리 기반 큐 → RocketMQ 메시지 큐로 전환  
- 주문 요청 및 체결 이벤트를 메시지 큐를 통해 비동기 처리  
- 주문 데이터 손실 방지 및 성능 최적화  

#### 3️⃣ DB Insert 최적화 (배치 처리 적용)  
- 기존 단건 Insert 방식 → 배치 처리 방식으로 변경  
- (1차 수정): 배치 처리로 성능 개선  
- (2차 수정): CQRS (Command Query Responsibility Segregation) 패턴 적용 검토 후 반영 예정  

#### 4️⃣ 체결 결과 SSE(Server-Sent Events) 전송으로 변경  
- 기존 WebSocket 기반에서 SSE(Server-Sent Events) 방식 추가  
- (1차 수정): 서버에서 SSE 응답만 처리 (Postman에서 확인)  
- (2차 수정): 프론트엔드와 연결하여 WebSocket과 비교 테스트 예정  

---

### ✅ 금요일 오후 (점심 이후) TODO (2025.02.15)  
1. 전체 코드 리뷰 진행  
2. 리팩토링 (성능 개선 및 최적화 적용)  
3. RocketMQ 메시지 큐 튜닝  
4. SSE & WebSocket 비교 테스트 후 최종 방식 결정  

---

### ⚠️ 향후 개선할 사항  
- 다중 클라이언트 동시 처리 최적화  
- 서버 성능 최적화 (비동기 I/O, 고성능 데이터 저장 방식 검토)  
- SSE & WebSocket 최적 비교 후 선택  
- RocketMQ 설정 튜닝 및 안정화  
- 시장가 주문 체결 로직 추가 개선  

---

### 💡 결론  
- 클라이언트가 실시간 주식 시세를 직접 수신하고, 서버는 우선순위 큐 & RocketMQ 기반 주문 매칭을 수행  
- 체결된 주문을 SSE/WebSocket으로 실시간 전송하여 UI에서 즉시 반영  
- 1차 MVP에서 기본적인 주문 처리 및 체결 로직을 완료  
- 2차 개선에서는 시장가 반영, CQRS, RocketMQ 최적화를 진행 예정  

---
